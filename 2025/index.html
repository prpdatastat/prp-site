<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRP Statistics</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sync-fetch"></script>
    
    <script src="../2025/main.js"></script>
    <link
    href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.8/r-3.0.2/sl-2.0.3/datatables.min.css"
    rel="stylesheet"
  />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-2.0.8/b-3.0.2/b-html5-3.0.2/datatables.min.js"></script>
    <link rel="stylesheet" href="../index.css" />
    <link rel="stylesheet" href="../site-theme.css" />
  </head>
  <body>
    <!-- NAV -->
      <nav class="navbar main-navbar" aria-label="Main navigation">
        <div class="nav-content">
          <div style="display:flex;align-items:center;gap:12px">
            <img class="logo" onclick="gotoUrl()" src="../logo.png" alt="PRP" />
            <button id="menu-toggle" class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false" style="display:none; border:0; background:transparent; color:var(--muted); font-weight:800; font-size:1.3rem;">â˜°</button>
            <ul class="nav-links" style="display:flex;gap:8px;">
              <li><a href="index.html" class="active">Home</a></li>              
              <li><a href="/prp-site/2025/merit.html">Unofficial Merit</a></li>
            </ul>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="color:var(--muted); font-weight:700;">Updated: Official Gazette</span>
          </div>
        </div>
      </nav>

      <!-- Primary notification -->
      <div id="notif" class="notice-card notice-info" role="region" aria-live="polite" aria-atomic="true">
  <div class="notice-carousel" id="notice-carousel" tabindex="0" aria-label="Page notices">
    <!-- slides rendered by JS -->
  </div>

  <div class="notice-side" id="notice-side" aria-hidden="false">
    <div class="notice-controls" id="notice-controls" aria-hidden="false">
      <button id="notice-prev" aria-label="Previous notice">â—€</button>
      <button id="notice-next" aria-label="Next notice">â–¶</button>
    </div>

    <div class="notice-dots" id="notice-dots" aria-hidden="false"></div>
  </div>

  <div class="notice-progress" id="notice-progress" aria-hidden="true">
    <div class="bar" id="notice-progress-bar" style="width:0%"></div>
  </div>
</div>

      
        
        <div class="top-grid">
          <div>
            <div class="stats-grid">
              <div class="stat-card">
                <div id="FCPS" class="stat-number">â€”</div>
                <div class="stat-desc">FCPS</div>
                <div class="stat-correct" id="FCPS-correct">â€”</div>
              </div>
              <div class="stat-card">
                <div id="MS" class="stat-number">â€”</div>
                <div class="stat-desc">MS</div>
                <div class="stat-correct" id="MS-correct">â€”</div>
              </div>
              <div class="stat-card">
                <div id="MD" class="stat-number">â€”</div>
                <div class="stat-desc">MD</div>
                <div class="stat-correct" id="MD-correct">â€”</div>
              </div>
            </div>

            <div class="controls" style="margin-top:14px;">
              <div style="min-width:320px; display:flex; gap:10px; align-items:center;">
                <!-- placeholder for future small controls -->
              </div>
              <div style="flex:1;">
                <div class="filters">
                  <select onchange="updateList(event);" class="filter-item" name="quota" id="program">
                    <option value="" disabled selected>Program</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div style="font-weight:800; color:var(--accent);">Unofficial Gazette 2026</div>
            <div style="color:var(--muted); margin-top:6px;">This page displays the unofficial gazette-based merit list for January 2026.</div>
          </div>
        </div>
      <div class="table-card">
        <div class="table-container">
          <table class="stat-table" style="width: 100%" id="statTable">
            <thead>
              <tr>
                <th class="linkable">Applicant ID</th>
                <th >PMDC Number</th>
                <th >Name</th>
                <th >Matric</th>
                <th >Inter</th>            
                <th >Degree</th>
                <th >MDCAT</th>
                <th >House Job</th>
                <th >Experience</th>
                <th >Porgarm Marks</th>
                <th >Position</th>
                <th>Aggregate</th>       
              </tr>
            </thead>
            <tbody id="dataRows"></tbody>
          </table>
        </div>
      </div>
      <div class="footer">
        <span>Made with ðŸ’“ in <strong>HTML</strong>  &  <strong>JS</strong> by <img src="../github.png">reko-beep</span>
      </div>
    </div>
    </div>
  </body>
  <script>
    const default_filter = {
      program: "MS"     
    };
    
    const columnParams = ['applicantId', 'pmdcNo', 'nameFull', ,'marksTotal', 'scrutinyStatus'];
    
    jQuery(document).ready(function () {
      /*
      const issueele = document.getElementById('issues');
      console.log(issueele)
      issueele.innerHTML += "Issues with candidate ids:<br>"
      for (prog in issueIds) {
        
      issueele.innerHTML += "<span class='linkable'>"+prog+" </span>" + issueIds[prog].join("</span>,<span class='idhover'> ")+"<br>"
      }*/
      jQuery("#statTable").DataTable({
        paging: true,
        searching: true,
        ordering: true,
        lengthMenu: [10, 25, 50, { label: "All", value: -1 }],
        lengthChange: true,
        layout: {
          topStart: {
              buttons: [
                {
                    extend: 'pdfHtml5',
                    text: 'Download PDF',
                    title : 'gazetteOfficial',
                    customize: function (doc) {
                        
                        let table = doc.content[1].table.body;
                        console.log(table)
                       
                        var cols = [];
                        cols[0] = {text: 'List downloaded', alignment: 'left', margin:[20] };
                        cols[1] = {text: 'from PRP statistics', alignment: 'right', margin:[0,0,20] };
                        var objFooter = {};
                        objFooter['columns'] = cols;
                        doc['footer']=objFooter;

                        }
                        }
                        // Data URL generated by http://dataurl.net/#dataurlmaker
                    
                
            ]
          }
    },
    
        columns: [
          { width: "10%" },
          { width: "20%" },
          { width: "10%" },
          { width: "10%" },
          
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
          { width: "10%" },
        ],
        
        order: [[10, 'desc']],
      });
      changeGazetteList();
    });
    
    async function changeGazetteList() {
      let gazette = getGazetteData(default_filter.program);
      jQuery("#statTable").DataTable().clear().draw();
  
      for (cand in gazette) {
        jQuery("#statTable")
          .DataTable()
          .row.add([
          gazette[cand].applicantId,
            gazette[cand].pmdcNo,
            gazette[cand].nameFull,
            gazette[cand].matric,
            gazette[cand].fsc,
            gazette[cand].degree,            
            gazette[cand].mdcat,
            gazette[cand].houseJob,
            gazette[cand].experience,
            gazette[cand].marksProgram,
            gazette[cand].position,
            gazette[cand].marksTotal,
                ]);
      }
      jQuery("#statTable").DataTable().draw();
    }
      
      $('#statTable').on('click', 'tbody td', function() {   
        let param =   columnParams[this._DT_CellIndex.column];
        let paths = {
          applicantId : '../2025/candidate.html'
        }
        const checkParams = ['applicantId'];
        if (checkParams.includes(columnParams[this._DT_CellIndex.column]))
        {
        localStorage.setItem(columnParams[this._DT_CellIndex.column], this.textContent)
        window.location.href = paths[param]
        }
      }
  ) 
    


    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    const filters = document.getElementsByTagName("select");
    console.log(filters);
    for (filter in filters) {
      let options = ['FCPS', 'MD', 'MS'];
      for (opt in options) {
        filters[filter].innerHTML +=
          "<option value='" + options[opt] + "'>" + options[opt] + "</option>";
      }
    }
    for (key in default_filter) {
      const ele = document.getElementById(key);
      ele.value = default_filter[key];
    }
    function updateList(e) {
      default_filter[e.target.id] = e.target.value;
      console.log(default_filter);
      changeGazetteList();
    }
    for (program in candidates) {
      console.log(candidates[program])
      const ele = document.getElementById(program);
      ele.innerHTML = candidates[program];
    }
    async function checkScrutiny(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getScrutiny(applicantId);

    }
   
  </script>
  <script src="../site-theme.js"></script>
  <script>
const PAGE_NOTICES = [
  {
    badge: 'Announcement',
    title: 'Unofficial Gazette uploaded',
    subtitle: 'Experience, House Job, Degree and MDCAT marks have been added â€” computed aggregates may differ from the official list.',
    extra: 'Note: Program marks exist on the backend for FCPS and MD/MS but are not yet applied here; final aggregates may change when they are included.',
    ctaText: 'View Gazette',
    ctaHref: '/prp-site/2025/index.html',
    tone: 'warn' // 'info'|'warn'|'success'
  },
   {
    badge: 'IMPORTANT',
    title: 'Unofficial Gazette uploaded',
    subtitle: 'Experience, House Job, Degree and MDCAT marks have been added â€” Candidate pages should only be used for preferences not for their aggregate. TOTAL MARKS are according to PPM 2026 Policy minus attempt marks',
    extra: 'Note: Program marks  (attempt) exist on the backend for FCPS and MD/MS but are not yet applied here; .',
    ctaText: 'View Gazette',
    ctaHref: '/prp-site/2025/index.html',
    tone: 'warn' // 'info'|'warn'|'success'
  },
  {
    badge: 'Info',
    title: 'Automated estimate â€” informational only',
    subtitle: 'This list is computer-generated and intended to give a rough idea; the data are fetched from the official database and are not fictitious.',
    extra: 'Do not treat this as finalâ€”consult the official gazette for authoritative results.',
    ctaText: 'Understood',
    ctaHref: '/prp-site/2025/index.html',
    tone: 'info'
  },
  {
    badge: 'Link',
    title: 'See computed merits',
    subtitle: 'View merit estimates for the upcoming cycle.',
    extra: 'Click through to see computed merit lists.',
    ctaText: 'Open 2026 Merit',
    ctaHref: '/prp-site/2026/merit.html',
    tone: 'info'
  }
];

const NOTICE_INTERVAL = 8000; // ms, change if you want faster/slower rotation

const NoticeSlideshow = (function () {
  let notices = [];
  let idx = 0;
  let timer = null;
  let interval = NOTICE_INTERVAL;
  const carousel = document.getElementById('notice-carousel');
  const dotsEl = document.getElementById('notice-dots');
  const prevBtn = document.getElementById('notice-prev');
  const nextBtn = document.getElementById('notice-next');
  const controls = document.getElementById('notice-controls');
  const progressBar = document.getElementById('notice-progress-bar');

  function buildSlides(arr) {
    notices = Array.isArray(arr) ? arr.slice() : [];
    carousel.innerHTML = '';
    dotsEl.innerHTML = '';

    if (!notices.length) { carousel.innerHTML = '<div class="notice-slide active"><div class="notice-content"><div class="notice-left"><div class="notice-badge">Info</div></div><div class="notice-body"><div class="notice-title">No notices</div><div class="notice-sub">There are no page notices at the moment.</div></div></div></div>'; controls.classList.add('hidden'); dotsEl.classList.add('hidden'); return; }

    notices.forEach((n, i) => {
      const slide = document.createElement('div');
      slide.className = 'notice-slide';
      slide.dataset.index = i;
      slide.setAttribute('role', 'group');
      slide.setAttribute('aria-roledescription', 'slide');

      // Build slide DOM (avoid template literal innerHTML to prevent backtick/escape issues)
      const content = document.createElement('div');
      content.className = 'notice-content';

      const left = document.createElement('div');
      left.className = 'notice-left';
      const badge = document.createElement('div');
      badge.className = 'notice-badge';
      badge.style.borderLeft = '0';
      badge.style.padding = '8px 10px';
      badge.style.fontWeight = '800';
      badge.style.color = (n.tone === 'warn') ? 'var(--accent-2)' : 'var(--accent)';
      badge.textContent = n.badge || '';
      left.appendChild(badge);

      const body = document.createElement('div');
      body.className = 'notice-body';
      const title = document.createElement('div');
      title.className = 'notice-title';
      title.textContent = n.title || '';
      const sub = document.createElement('div');
      sub.className = 'notice-sub';
      sub.style.marginTop = '6px';
      // allow light HTML in subtitle/extra if present
      sub.innerHTML = n.subtitle || '';
      body.appendChild(title);
      body.appendChild(sub);
      if (n.extra) {
        const extra = document.createElement('div');
        extra.className = 'notice-extra';
        extra.textContent = n.extra;
        body.appendChild(extra);
      }
      if (n.ctaText) {
        const cwrap = document.createElement('div');
        cwrap.style.marginTop = '10px';
        const btn = document.createElement('button');
        btn.className = 'notice-btn small';
        btn.dataset.href = n.ctaHref || '';
        btn.dataset.index = i;
        btn.setAttribute('aria-label', 'Open notice link');
        btn.style.cssText = 'background:linear-gradient(90deg,var(--accent),#2fc7b8); color:#071017; padding:6px 10px; border-radius:8px; font-weight:800; border:none; cursor:pointer';
        btn.textContent = n.ctaText;
        btn.addEventListener('click', () => { if (btn.dataset.href) window.location.href = btn.dataset.href; });
        cwrap.appendChild(btn);
        body.appendChild(cwrap);
      }

      content.appendChild(left);
      content.appendChild(body);
      slide.appendChild(content);
       carousel.appendChild(slide);

      // dot (kept same)
      const dot = document.createElement('button');
      dot.className = 'notice-dot';
      dot.setAttribute('aria-label', `Show notice ${i + 1}`);
      dot.dataset.index = i;
      dot.addEventListener('click', () => showNotice(i, true));
      dotsEl.appendChild(dot);
    });

    // show first slide
    idx = 0;
    showNotice(0);
    attachCTAs();
    controls.classList.toggle('hidden', notices.length <= 1);
    dotsEl.classList.toggle('hidden', notices.length <= 1);
  }

  function attachCTAs() {
    carousel.querySelectorAll('.notice-btn').forEach(b => {
      b.addEventListener('click', (e) => {
        const href = b.dataset.href;
        if (href) window.location.href = href;
      });
    });
  }

  function showNotice(i, userTriggered = false) {
    const slides = carousel.querySelectorAll('.notice-slide');
    slides.forEach(s => s.classList.remove('active'));
    const dots = dotsEl.querySelectorAll('.notice-dot');
    dots.forEach(d => d.classList.remove('active'));
    const slide = slides[i];
    if (slide) slide.classList.add('active');
    if (dots[i]) dots[i].classList.add('active');
    idx = i;
    resetProgress();
    if (userTriggered) { restartAutoplay(); }
    // set tone class on outer container
    const tone = (notices[i] && notices[i].tone) || 'info';
    const wrap = document.getElementById('notif');
    wrap.classList.remove('notice-info', 'notice-warn', 'notice-success');
    wrap.classList.add('notice-' + (tone || 'info'));
  }

  function next() { showNotice((idx + 1) % notices.length, false); }
  function prev() { showNotice((idx - 1 + notices.length) % notices.length, false); }

  function startAutoplay() {
    clearTimer();
    if (notices.length <= 1) return;
    progressBar.style.transition = `none`;
    progressBar.style.width = '0%';
    // allow CSS reflow before animation
    requestAnimationFrame(() => {
      progressBar.style.transition = `width ${interval}ms linear`;
      progressBar.style.width = '100%';
    });
    timer = setTimeout(() => {
      next();
      startAutoplay();
    }, interval);
  }

  function resetProgress() {
    progressBar.style.transition = 'none';
    progressBar.style.width = '0%';
    // restart progress
    requestAnimationFrame(() => {
      progressBar.style.transition = `width ${interval}ms linear`;
      progressBar.style.width = '100%';
    });
  }

  function pause() { clearTimer(); progressBar.style.transition = 'none'; }
  function resume() { startAutoplay(); }

  function clearTimer() { if (timer) { clearTimeout(timer); timer = null; } }

  function restartAutoplay() { clearTimer(); startAutoplay(); }

  function wireUI() {
    nextBtn.addEventListener('click', () => { next(); restartAutoplay(); });
    prevBtn.addEventListener('click', () => { prev(); restartAutoplay(); });

    // pause on hover/focus for accessibility
    const wrap = document.getElementById('notif');
    ['mouseenter','focusin'].forEach(ev => wrap.addEventListener(ev, pause));
    ['mouseleave','focusout'].forEach(ev => wrap.addEventListener(ev, resume));

    // keyboard navigation: left/right arrows
    wrap.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') { next(); restartAutoplay(); }
      if (e.key === 'ArrowLeft') { prev(); restartAutoplay(); }
    });
  }

  function setNotices(arr, opts = {}) {
    if (!Array.isArray(arr)) arr = [arr];
    notices = arr.slice();
    interval = opts.interval || NOTICE_INTERVAL;
    buildSlides(notices);
    startAutoplay();
  }

  // public API
  return {
    init: function (arr, opts = {}) { setNotices(arr || [], opts); wireUI(); },
    set: setNotices,
    next, prev, pause, resume, getCurrent: () => idx
  };
})();

// Init slideshow on DOM ready using PAGE_NOTICES; keeps backward-compatible single PAGE_NOTICE too
document.addEventListener('DOMContentLoaded', () => {
  NoticeSlideshow.init(PAGE_NOTICES);
});

// Backwards-compatible helper to set a single page notice
function setPageNotice(newCfg) {
  // accept either single object or array
  if (Array.isArray(newCfg)) NoticeSlideshow.set(newCfg);
  else NoticeSlideshow.set([newCfg]);
}

// convenience: programmatic update of the notices array
function setPageNotices(noticesArray, opts = {}) {
  NoticeSlideshow.set(noticesArray, opts);
}
</script>
</html>
