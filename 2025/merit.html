<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRP Statistics</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sync-fetch"></script>
    <script id='data' src="../2025/main.js"></script>
    <link
    href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.8/r-3.0.2/sl-2.0.3/datatables.min.css"
    rel="stylesheet"
  />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-2.0.8/b-3.0.2/b-html5-3.0.2/datatables.min.js"></script>
    <link rel="stylesheet" href="../index.css" />
    <link rel="stylesheet" href="../site-theme.css" />
    
  </head>
  <body>
     <!-- NAV -->
      <nav class="navbar main-navbar" aria-label="Main navigation">
        <div class="nav-content">
          <div style="display:flex;align-items:center;gap:12px">
            <img class="logo" onclick="gotoUrl()" src="../logo.png" alt="PRP" />
            <button id="menu-toggle" class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false" style="display:none; border:0; background:transparent; color:var(--muted); font-weight:800; font-size:1.3rem;">‚ò∞</button>
            <ul class="nav-links" style="display:flex;gap:8px;">
              <li><a href="../index.html" class="active">Home</a></li>
         
              <li><a href="/prp-site/2025/index.html">Unofficial Gazette</a></li>
     
            </ul>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="color:var(--muted); font-weight:700;">Updated: Official Gazette</span>
          </div>
        </div>
      </nav>

      <!-- Primary notification -->
      <div id="notif" class="notice-card notice-info" role="region" aria-live="polite" aria-atomic="true">
  <div class="notice-carousel" id="notice-carousel" tabindex="0" aria-label="Page notices">
    <!-- slides rendered by JS -->
  </div>

  <div class="notice-side" id="notice-side" aria-hidden="false">
    <div class="notice-controls" id="notice-controls" aria-hidden="false">
      <button id="notice-prev" aria-label="Previous notice">‚óÄ</button>
      <button id="notice-next" aria-label="Next notice">‚ñ∂</button>
    </div>

    <div class="notice-dots" id="notice-dots" aria-hidden="false"></div>
  </div>

  <div class="notice-progress" id="notice-progress" aria-hidden="true">
    <div class="bar" id="notice-progress-bar" style="width:0%"></div>
  </div>
</div>
        

 
     
       
      <!--<h3 class="linkableunderline" onclick="gotoComment()"> Wanna Leave a comment for developer? Click here!</h3>-->
      <!--
      <div class="consent-pref-switch">
        <label class="switch">
          <input id="checkbox2025" onchange="changeMeritYear(this)" type="checkbox">
          <span class="slider"></span>
        </label><span class="slidertext"> 2025 Unofficial Merit List</span> 
      </div>  
       -->      
       <!--
        <h3 class="title">Unofficial Merit List</h3>
        <div class="alert">
          <h3 class="alert-title">For People claiming this list is fake!</h3>
          <p class="alert-content"><br>

This merit list is generated automatically using publicly available data from the official government website. The data is fetched through public endpoints , but not directly visible to end users.
<br>
üîπ It is NOT <strong>fake.</strong<br>
üîπ However, it is not <strong>official and may contain technical or calculation errors.</strong>
<br>
This list is intended for informational purposes only and should not be treated as the final or authoritative version. The official merit list will always be published by the relevant government department.

If you notice any discrepancy, feel free to report it. We welcome feedback and aim to keep the process transparent and open.</span><br>
<strong> The list is unofficial but real. It's not fake ‚Äî just not final.‚Äù
‚ÄúIf there‚Äôs a mistake, it‚Äôs in logic ‚Äî not in intention"<strong></p>-->
          <!--<h3 class="alert-title">Upcoming 5th Merit List estimated changes</h3>-->
          <!--<p class="alert-content"><span class="linkableunderline" onclick="gotoUrl('upgrade.html')">Click here to see changes in upcoming list</span></p>-->
    <div class="controls" style="margin-top:14px;">
              <div style="min-width:320px; display:flex; gap:10px; align-items:center;">
                <!-- placeholder for future small controls -->
              </div>
              <div style="flex:1;">
                <div class="filters">
        <select
          onchange="updateList(event);"
          class="filter-item"
          name="quota"
          id="program"
        >
          <option value="" disabled selected>Program</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item"
          name="speciality"
          id="quota"
        >
          <option value="" selected>Quota</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item"
          name="quota"
          id="speciality"
        >
          <option value="" selected>Speciality</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item"
          name="quota"
          id="hospital"
        >
          <option value="" elected>Hospital</option>
        </select>
      </div>
              </div>
            </div>
          </div>
      <h4 class="seats"> Seats Occupied: <span class="important" id="occupied">1</span> / <strong id="total"> 2 </strong></h4>
      <div class="table-toggle card">
  <label class="toggle-label">
    <span class="toggle-text">Without attempt marks</span>

    <input type="checkbox" id="tableToggle" onchange="withAttemptMaks(this);"/>
    <span class="toggle-switch"></span>

    <span class="toggle-text">With attempt marks</span>
  </label>
</div>
  <div class='card'><span  style="font-weight:800; color:var(--text-desc);">If you select an option in all four dropdowns ‚Äî Speciality, Program, Hospital, and Quota ‚Äî the table will show next-in-line candidates who may be considered if the currently selected candidate does not give consent.</span>
  </div>
      <div class="card">
            <div style="font-weight:800; color:var(--accent);" id="headline"></div>
          </div>
        
      </div>
      <div class="table-card">
        <div class="table-container">
          <table class="stat-table table-fade active" style="width: 100%" id="statTable">
            <thead>
              <tr>
                <th class="linkable">PMDC Number</th>
                <th >Name</th>
                <th>Quota</th>
                <th>Speciality</th>
                <th>Hospital</th>
                <th>Aggregate + AttemptMark</th>
                <th>Preference No.</th>
              </tr>
            </thead>
            <tbody id="dataRows"></tbody>
          </table>
        </div>
      </div>
      <div class="table-card">
        <div class="table-container">
          <table class="stat-table table-fade" style="width: 100%" id="statTableAttemptMarks">
            <thead>
              <tr>
                <th class="linkable">PMDC Number</th>
                <th >Name</th>
                <th>Quota</th>
                <th>Speciality</th>
                <th>Hospital</th>
                <th>Aggregate + AttemptMark</th>
                <th>Preference No.</th>
              </tr>
            </thead>
            <tbody id="dataRows"></tbody>
          </table>
        </div>
      </div>
      <br>
     
<br>
<!-- begin wwww.htmlcommentbox.com -->
<div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">Comment Box</a> is loading comments...</div>
<script type="text/javascript" id="hcb"> /*<!--*/ if(!window.hcb_user){hcb_user={};} (function(){var s=document.createElement("script"), l=hcb_user.PAGE || (""+window.location).replace(/'/g,"%27"), h="https://www.htmlcommentbox.com";s.setAttribute("type","text/javascript");s.setAttribute("src", h+"/jread?page="+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24mzyYuuZBe1GhURDyiqYE4%2F"+"&opts=16798&num=10&ts=1736005452841");if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})(); /*-->*/ </script>
<!-- end www.htmlcommentbox.com -->
<script src="../site-theme.js"></script>

      <div class="footer">
        <span>Made with üíì in <strong>HTML</strong>  &  <strong>JS</strong> by <img src="../github.png">reko-beep</span>
      </div>
    </div>
    </div>
  </body>
  <script>
    const default_filter = {
      program: "MS",
      quota: "",
      speciality: "",
      hospital: "",
    };
    let meritData = {
      MS: load_data('../2025/ms_merit.json'),
      MD: load_data('../2025/md_merit.json'),
      FCPS: load_data('../2025/fcps_merit.json'),
    };
    const columnParams = ['pmdcNo', 'name', 'quotaName', 'specialityName', 'hospitalName']
    jQuery(document).ready(function () {
      $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    
      jQuery("#statTable").DataTable({
        order: [[5, 'desc']],
        paging: true,
        searching: true,
        ordering: true,
        lengthMenu: [10, 25, 50, { label: "All", value: -1 }],
        lengthChange: true,
        layout: {
          topStart: {
              buttons: [
                {
                    extend: 'pdfHtml5',
                    text: 'Download PDF',
                    title : '5th_merit_list',
                    customize: function (doc) {
                        
                        let table = doc.content[1].table.body;
                        console.log(table)
                        for (i = 1; i < table.length; i++) // skip table header row (i = 0)
                        {
                          let txt = table[i][6].text.replace('Check Joining', '')
                          table[i][6].text = txt; // couldn't be bothered clearing the Age column sample data above :)
                          
                        }
                        console.log(doc['header'])
                        var cols = [];
                        cols[0] = {text: 'List downloaded', alignment: 'left', margin:[20] };
                        cols[1] = {text: 'from PRP statistics', alignment: 'right', margin:[0,0,20] };
                        var objFooter = {};
                        objFooter['columns'] = cols;
                        doc['footer']=objFooter;

                        }
                        }
                        // Data URL generated by http://dataurl.net/#dataurlmaker
                    
                
            ]
          }
    },
    
        columns: [
          { width: "10%" },
          { width: "20%" },
          { width: "10%" },
          { width: "10%" },
          { width: "20%" },
          { width: "5%" },
          { width: "5%" },
        ],

      },
    );
      changeMeritList();
    });
    
    async function changeMeritList() {
      const ele = document.getElementById('headline');
      ele.innerHTML = changeHeadline(default_filter);
      let merit = getMerit(
        meritData[default_filter.program],
        default_filter.quota,
        default_filter.speciality,
        default_filter.hospital
      );
      console.log(merit);
      let seats = getSeatsOccupied(meritData[default_filter.program],default_filter.program,  default_filter.quota, default_filter.hospital, default_filter.speciality);
      for (k in seats) {        
        const ele = document.getElementById(k).innerHTML = seats[k]
      }
      jQuery("#statTable").DataTable().clear().draw();
      
  const rowNodes = [];
      for (const cand in merit) {
  const check = document.getElementById('tableToggle');
  if (check.checked) {

   

    // ‚ûú version WITHOUT program marks
    jQuery("#statTable").DataTable().row.add([
      merit[cand].pmdcNo,
      merit[cand].nameFull,
      merit[cand].quotaName,
      merit[cand].specialityName,
      merit[cand].hospitalName,
      merit[cand].marksTotal,
      "Pref No." + merit[cand].preferenceNo,
    ]);
     if (
      default_filter.hospital !== "" &&
      default_filter.speciality !== "" &&
      default_filter.quota !== ""
    ) {
      let candsNext =  getNextInLineCandidates(default_filter.program, {
          quotaName: default_filter.quota,
          specialityName: default_filter.speciality,
          hospitalName: default_filter.hospital
        })
        for (cd in candsNext) {
          console.log('next in line candidate', candsNext[cd])
        const rowNode = jQuery("#statTable").DataTable().row.add([
      candsNext[cd].pmdcNo+"<br> <sub style='color:var(--text-desc);'> Next in line</sub>",
      candsNext[cd].nameFull,
      candsNext[cd].quotaName,
      candsNext[cd].specialityName,
      candsNext[cd].hospitalName,
      candsNext[cd].marksTotal,
      "Pref No." + candsNext[cd].preferenceNo,
    ]);
    rowNodes.push(rowNode);
    }

  } 
}else {

    

    // ‚ûú version WITH program marks
    jQuery("#statTable").DataTable().row.add([
      merit[cand].pmdcNo,
      merit[cand].nameFull,
      merit[cand].quotaName,
      merit[cand].specialityName,
      merit[cand].hospitalName,
      merit[cand].marksTotal +
        "<sub style='color:var(--text-desc);'>+" +
        getProgramMark(merit[cand].applicantId, default_filter.program) +
        "</sub>",
      "Pref No." + merit[cand].preferenceNo,
    ]);
    if (
      default_filter.hospital !== "" &&
      default_filter.speciality !== "" &&
      default_filter.quota !== ""
    ) {
      let candsNext =  getNextInLineCandidates(default_filter.program, {
          quotaName: default_filter.quota,
          specialityName: default_filter.speciality,
          hospitalName: default_filter.hospital
        })
        for (cd in candsNext) {
          console.log('next in line candidate', candsNext[cd])
        const rowNode = jQuery("#statTable").DataTable().row.add([
      candsNext[cd].pmdcNo+"<br> <sub style='color:var(--text-desc);'> Next in line</sub>",
      candsNext[cd].nameFull,
      candsNext[cd].quotaName,
      candsNext[cd].specialityName,
      candsNext[cd].hospitalName,
      candsNext[cd].marksTotal+
       "<sub style='color:var(--text-desc);'>+" +
        getProgramMark(merit[cand].applicantId, default_filter.program) +
        "</sub>",
      "Pref No." + candsNext[cd].preferenceNo,
    ]);
    
    }

  } 
  }
}
      jQuery("#statTable").DataTable().draw();
    
    }
  
      $('#statTable').on('click', 'tbody td', function() {   
        let param =   columnParams[this._DT_CellIndex.column];
        let paths = {
          pmdcNo : 'candidate.html'
        }
        const checkParams = [ 'pmdcNo'];
        if (checkParams.includes(columnParams[this._DT_CellIndex.column]))
        {
          console.log(getApplicantId(this.textContent), this.textContent)
        localStorage.setItem('applicantId', getApplicantId(this.textContent))
        window.location.href = paths[param]
        }
      }
  ) 
    


    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    const filters = document.getElementsByTagName("select");
    console.log(filters);
    for (filter in filters) {
      let options = getOptions(filters[filter].id);
      console.log(options, filters[filter].id);
      for (opt in options) {
        filters[filter].innerHTML +=
          "<option value='" + options[opt] + "'>" + options[opt] + "</option>";
      }
    }
    for (key in default_filter) {
      const ele = document.getElementById(key);
      ele.value = default_filter[key];
    }
    function updateList(e) {
      default_filter[e.target.id] = e.target.value;
      console.log(default_filter);
      changeMeritList();
    }
   function getProgramMark(applicantId, program) {
      let cD = cand_data;
      if (applicantId in cD){
          if (program in cD[applicantId]['programMark']){
          console.log(cD[applicantId]['nameFull'],cD[applicantId]['programMark'][program])
            return cD[applicantId]['programMark'][program];

        }else {
          return 0;
        }
      }
      return 0;
    }
    
    async function checkConsent(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getConsent(applicantId);

    }
    async function checkJoining(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getJoining(applicantId);

    }

    /*
    function changeMeritYear(e) {
      
  if (e.checked) {
    localStorage.setItem('viewUnofficial', 'true');
    meritData.FCPS = fcpsMeritUnOfficial;
    meritData.MS = msMeritUnOfficial;
    meritData.MD = mdMeritUnOfficial;
    candData = candDataUnOfficial;
    changeMeritList()
    $('.slidertext').css({'color': 'white', 'font-weight': 'bold', 'filter': 'drop-shadow(0px 0px 7px #107e47)', 'transition-duration': '1s'})
    changeNotification("This is a unofficial Merit list based on unofficial<span class='important'> 2025 Jan</span> Gazette<br>To compare ur merit, see unofficial gazette and click on applicant ID <br><span class='important'>Click on speciality or hospital to see individual merits</span><br>Merit list is updated according to current policy, without program marks.<br><span class='important'>Now you can see how many seats are occupied for  specific speciality and hospital</span>")
    
  }else {
    localStorage.setItem('viewUnofficial', 'false');
    meritData.FCPS = prevfcpsMeritList;
    meritData.MS = prevMsMeritList;
    meritData.MD = prevMdMeritList;
    candData = prevcandList;
    changeMeritList()
    changeNotification(" This is the Estimated Merit List of <span class='important'>2025 Jan</span> Induction<br>Accuracy of unofficial merit list has been displayed below<span class='important'>  </div>")
    $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    

  }
}*/
      

    function withAttemptMaks(e) {
      
  if (e.checked) {
    localStorage.setItem('attemptMarks', 'false');
    meritData = {
      MS: load_data('../2025/attemptmarks/ms_merit.json'),
      MD: load_data('../2025/attemptmarks/md_merit.json'),
      FCPS: load_data('../2025/attemptmarks/fcps_merit.json'),
    };
    changeMeritList()
    
  }else {
    localStorage.setItem('attemptMarks', 'false');
    meritData = {
      MS: load_data('../2025/ms_merit.json'),
      MD: load_data('../2025/md_merit.json'),
      FCPS: load_data('../2025/fcps_merit.json'),
    };
    changeMeritList()
   

  }
}
function gotoComment(){
  const ele = document.getElementById('HCB_comment_box');
  ele.scrollIntoView();
}
  </script>
  <script>
  
function getNextInLineCandidates(program, params = {}) {
  const prog = program;

  // Get the 'others' list
  const others = meritData[prog][prog][params.quotaName][params.specialityName][params.hospitalName]['others'];

  // Step 1: Build a fast lookup map of all already selected candidates
  const selectedApplicants = new Map();
  for (const quota of Object.keys(meritData[prog][prog])) {
    for (const speciality of Object.keys(meritData[prog][prog][quota])) {
      for (const hospital of Object.keys(meritData[prog][prog][quota][speciality])) {
        const candidates = meritData[prog][prog][quota][speciality][hospital].candidates;
        for (const c of candidates) {
          if (!selectedApplicants.has(c.applicantId) || c.preferenceNo < selectedApplicants.get(c.applicantId).preferenceNo) {
            selectedApplicants.set(c.applicantId, c);
          }
        }
      }
    }
  }

  // Step 2: Determine the minimum marks from already-selected candidates for this hospital
  const currentCandidates = meritData[prog][prog][params.quotaName][params.specialityName][params.hospitalName].candidates;
  const minMarks = Math.min(...currentCandidates.map(c => parseFloat(c.marksTotal)));

  // Step 3: Filter 'others' to include only those who:
  //   - Are not already selected with a better preference
  //   - Have marks <= minMarks (next in line)
  const result = [...new Map(
  others
    .filter(cand => {
      const selected = selectedApplicants.get(cand.applicantId);
      const isBelowMinMarks = parseFloat(cand.marksTotal) <= minMarks;
      return isBelowMinMarks && (!selected || selected.preferenceNo >= cand.preferenceNo);
    })
    .map(cand => [cand.applicantId, {
      nameFull: cand.nameFull,
      marksTotal: cand.marksTotal,
      pmdcNo: cand.pmdcNo,
      applicantId: cand.applicantId,
      preferenceNo: cand.preferenceNo,
      specialityName: params.specialityName,
      quotaName: params.quotaName,
      hospitalName: params.hospitalName
    }])
).values()]  // values() returns only the unique objects
.sort((a, b) => parseFloat(b.marksTotal) - parseFloat(a.marksTotal));
  return result;
}


</script>

</html>
