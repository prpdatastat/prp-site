<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRP Statistics</title>

    <!-- libs (kept as before) -->

    <!-- libs (kept as before) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sync-fetch"></script>
    <script id="data" src="data.js"></script>
    <script id="data" src="data.js"></script>
    <script src="schedule.js"></script>
    <script src="nil.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="nil.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link
      href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.8/r-3.0.2/sl-2.0.3/datatables.min.css"
      rel="stylesheet"
    />
      href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.8/r-3.0.2/sl-2.0.3/datatables.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-2.0.8/b-3.0.2/b-html5-3.0.2/datatables.min.js"></script>

    <!-- Modernized styles moved to shared stylesheet -->
    <link rel="stylesheet" href="site-theme.css" />

<!-- moved to site-theme.css -->
<!-- moved to site-theme.css -->


<!-- moved to site-theme.css -->
<!-- moved to site-theme.css -->
<!-- moved to site-theme.css -->
<!-- moved to site-theme.css -->
<!-- moved to site-theme.css -->

/* ensure native option readability if user opens native dropdown */
<!-- moved to site-theme.css -->
  </head>

  <body>
    <div class="page">

      <!-- NAV -->
      <nav class="navbar main-navbar" aria-label="Main navigation">
        <div class="nav-content">
          <div style="display:flex;align-items:center;gap:12px">
            <img class="logo" onclick="gotoUrl()" src="logo.png" alt="PRP" />
            <button id="menu-toggle" class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false" style="display:none; border:0; background:transparent; color:var(--muted); font-weight:800; font-size:1.3rem;">‚ò∞</button>
            <ul class="nav-links" style="display:flex;gap:8px;">
              <li><a href="index.html" class="active">Home</a></li>
              <li><a href="wasted.html">Wasted Seats</a></li>
              <li><a href="review.html">Training Reviews</a></li>
              <li><a href="cutoff.html">Cutoff Merits</a></li>
              <li><a href="schedule.html">Schedule</a></li>
              <li><a href="/prp-site/2025/index.html">Unofficial Gazette</a></li>
              <li><a href="prev.html">Prev Lists</a></li>
            </ul>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="color:var(--muted); font-weight:700;">Updated: Official Gazette</span>
          </div>
        </div>
      </nav>

      <!-- Primary notification -->
      <div id="notif" class="notice-card notice-info" role="region" aria-live="polite" aria-atomic="true">
  <div class="notice-carousel" id="notice-carousel" tabindex="0" aria-label="Page notices">
    <!-- slides rendered by JS -->
  </div>

  <div class="notice-side" id="notice-side" aria-hidden="false">
    <div class="notice-controls" id="notice-controls" aria-hidden="false">
      <button id="notice-prev" aria-label="Previous notice">‚óÄ</button>
      <button id="notice-next" aria-label="Next notice">‚ñ∂</button>
    </div>

    <div class="notice-dots" id="notice-dots" aria-hidden="false"></div>
  </div>

  <div class="notice-progress" id="notice-progress" aria-hidden="true">
    <div class="bar" id="notice-progress-bar" style="width:0%"></div>
  </div>
</div>

      <!-- Top area: stats and helper/tools -->
      <div class="top-grid">
        <!-- left: stats -->
        <div>
          <div class="stats-grid">
            <div class="stat-card">
              <div id="FCPS" class="stat-number">‚Äî</div>
              <div class="stat-desc">FCPS</div>
              <div class="stat-correct" id="FCPS-correct">‚Äî</div>
            </div>
            <div class="stat-card">
              <div id="MS" class="stat-number">‚Äî</div>
              <div class="stat-desc">MS</div>
              <div class="stat-correct" id="MS-correct">‚Äî</div>
            </div>
            <div class="stat-card">
              <div id="MD" class="stat-number">‚Äî</div>
              <div class="stat-desc">MD</div>
              <div class="stat-correct" id="MD-correct">‚Äî</div>
            </div>
          </div>

          <!-- controls + table headline -->
          <div class="controls" style="margin-top:14px;">
            <div style="min-width:320px; display:flex; gap:10px; align-items:center;">
              <input id="pmdc-input" class="search-input search-input-sm" type="text" placeholder="üîé Enter PMDC Number" onkeydown="if(event.key==='Enter'){getCandidateMerit();}" />
              <button class="btn" onclick="getCandidateMerit()">Search</button>
            </div>

            <div style="flex:1;">
              <div class="filters">
                <select onchange="updateList(event);" class="filter-item" id="program"><option value="" disabled selected>Program</option></select>
                <select onchange="updateList(event);" class="filter-item" id="quota"><option value="" selected>Quota</option></select>
                <select onchange="updateList(event);" class="filter-item" id="speciality"><option value="" selected>Speciality</option></select>
                <select onchange="updateList(event);" class="filter-item" id="hospital"><option value="" selected>Hospital</option></select>
              </div>
            </div>
          </div>
        </div>

        <!-- right: helper card with tabs -->
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
            <div style="font-weight:800; color:var(--accent);">Tools</div>
            <div style="color:var(--muted); font-weight:700; font-size:0.95rem;" id="helper-status">Ready</div>
          </div>

          <div class="tabs" style="margin-top:12px;">
            <button class="tabbtn active" data-tab="search-tab">PMDC Search</button>
            <button class="tabbtn" data-tab="near-tab">Near-merit</button>
            <button class="tabbtn" data-tab="about-tab">About</button>
          </div>

          <div id="search-tab" class="tabpanel active">
            <div class="search-row">
              <input id="pmdc-input-2" class="search-input" placeholder="Enter PMDC number" onkeydown="if(event.key==='Enter'){document.getElementById('pmdc-input').value=this.value; getCandidateMerit();}" />
              <button class="btn" onclick="document.getElementById('pmdc-input').value=document.getElementById('pmdc-input-2').value; getCandidateMerit();">Go</button>
            </div>
            <div style="color:var(--muted); font-size:0.95rem;">Enter a PMDC number and press Enter or Go to jump to the candidate page.</div>
          </div>

          <div id="near-tab" class="tabpanel">
            <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
              <input id="merit-input" type="number" placeholder="Your merit (e.g. 31.2)" class="search-input" />
              <input id="merit-threshold" type="number" step="0.1" value="3" style="width:92px;" class="search-input" />
            </div>
            <div style="display:flex; gap:8px;">
              <select id="near-speciality" class="filter-item"><option value="">Any Speciality</option></select>
              <select id="near-hospital" class="filter-item"><option value="">Any Hospital</option></select>
            </div>
            <div style="margin-top:10px;"><button class="btn" onclick="showNearMeritMatches()">Show Matches</button></div>
            <div id="near-results" style="margin-top:10px; color:var(--muted); font-size:0.95rem;"></div>
          </div>

          <div id="about-tab" class="tabpanel">
            <div style="color:var(--muted); font-size:0.95rem;">
              The site compares unofficial lists with the official gazette. Unofficial lists were pulled from PRP backend and were <b>not scrutinized</b>. Always consult the official gazette for final results. Transparency and accuracy are core goals.
            </div>
          </div>
        </div>
      </div>

      <!-- Table section -->
      <div class="table-card">
        <p id="headline" class="headline">No Filter selected.</p>
        <table class="stat-table" style="width: 100%" id="statTable">
          <thead>
            <tr>
              <th>PMDC Number</th>
              <th>Name</th>
              <th>Quota</th>
              <th>Speciality</th>
              <th>Hospital</th>
              <th>Aggregate</th>
              <th>Preference No.</th>
            </tr>
          </thead>
          <tbody id="dataRows"></tbody>
        </table>

        <div id="nonJoinNotif" style="display:none; margin-top:12px;"></div>
      </div>

      <!-- Comments + footer -->
      <div style="margin-top:18px;">
        <div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">Comment Box</a> is loading comments...</div>

      <!-- Table section -->
      <div class="table-card">
        <p id="headline" class="headline">No Filter selected.</p>
        <table class="stat-table" style="width: 100%" id="statTable">
          <thead>
            <tr>
              <th>PMDC Number</th>
              <th>Name</th>
              <th>Quota</th>
              <th>Speciality</th>
              <th>Hospital</th>
              <th>Aggregate</th>
              <th>Preference No.</th>
            </tr>
          </thead>
          <tbody id="dataRows"></tbody>
        </table>

        <div id="nonJoinNotif" style="display:none; margin-top:12px;"></div>
      </div>

      <!-- Comments + footer -->
      <div style="margin-top:18px;">
        <div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">Comment Box</a> is loading comments...</div>
<script type="text/javascript" id="hcb"> /*<!--*/ if(!window.hcb_user){hcb_user={};} (function(){var s=document.createElement("script"), l=hcb_user.PAGE || (""+window.location).replace(/'/g,"%27"), h="https://www.htmlcommentbox.com";s.setAttribute("type","text/javascript");s.setAttribute("src", h+"/jread?page="+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24mzyYuuZBe1GhURDyiqYE4%2F"+"&opts=16798&num=10&ts=1736005452841");if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})(); /*-->*/ </script>
<!-- end www.htmlcommentbox.com -->

      </div>

      </div>

      <div class="footer">
        Made with ‚ù§ ‚Ä¢ PRP Statistics ‚Äî <a href="https://prpdatastat.github.io/prp-site/" target="_blank">main page</a>
        Made with ‚ù§ ‚Ä¢ PRP Statistics ‚Äî <a href="https://prpdatastat.github.io/prp-site/" target="_blank">main page</a>
      </div>
    </div>

    <!-- Small page script: tabs, helper status and auto-populate near filters -->
    <script>
      // Tabs
      document.querySelectorAll('.tabbtn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tabbtn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tabpanel').forEach(p => p.classList.remove('active'));
          document.getElementById(btn.dataset.tab).classList.add('active');
        });
      });

      // Update helper-status when filters change
      function setHelperStatus(text) {
        const el = document.getElementById('helper-status'); if (el) el.textContent = text;
        const helper = document.querySelector('.card'); helper && helper.animate([{ transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 360 });
      }

      // populate near-tab selects with existing options if available
      function populateNearFilters() {
        try {
          const specs = getOptions('speciality') || [];
          const hospitals = getOptions('hospital') || [];
          const sp = document.getElementById('near-speciality');
          const hp = document.getElementById('near-hospital');
          specs.forEach(s => sp.insertAdjacentHTML('beforeend', `<option value="${s}">${s}</option>`));
          hospitals.forEach(h => hp.insertAdjacentHTML('beforeend', `<option value="${h}">${h}</option>`));
        } catch (e) {}
      }
      populateNearFilters();

      // Simple helper function called by existing logic when filters change
      (function wireFiltersForStatus() {
        ['program','quota','speciality','hospital'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.addEventListener('change', (e) => {
            setHelperStatus(`Filtered by ${e.target.id}: ${e.target.value || 'All'}`);
            // allow existing updateList() to run as it already does
          });
        });
      })();

      // Allow pressing Enter in the small PMDC input to copy to main search and navigate
      document.getElementById('pmdc-input-2').addEventListener('keydown', function (e) { if (e.key === 'Enter') { document.getElementById('pmdc-input').value = this.value; getCandidateMerit(); } });

      // show near merit placeholder (connects to your existing showNearMeritMatches)
      function showNearMeritMatches() {
        const m = document.getElementById('merit-input').value;
        if (!m) { document.getElementById('near-results').textContent = 'Enter your merit first.'; return; }
        document.getElementById('near-results').textContent = 'Searching...';
        // call existing function if available
        if (typeof showNearMeritMatches === 'function' && showNearMeritMatches !== arguments.callee) {
          return showNearMeritMatches();
        }
        // otherwise show placeholder
        setTimeout(()=> document.getElementById('near-results').textContent = 'No matches (placeholder).', 600);
      }
    </script>

    <!-- Small page script: tabs, helper status and auto-populate near filters -->
    <script>
      // Tabs
      document.querySelectorAll('.tabbtn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tabbtn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tabpanel').forEach(p => p.classList.remove('active'));
          document.getElementById(btn.dataset.tab).classList.add('active');
        });
      });

      // Update helper-status when filters change
      function setHelperStatus(text) {
        const el = document.getElementById('helper-status'); if (el) el.textContent = text;
        const helper = document.querySelector('.card'); helper && helper.animate([{ transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 360 });
      }

      // populate near-tab selects with existing options if available
      function populateNearFilters() {
        try {
          const specs = getOptions('speciality') || [];
          const hospitals = getOptions('hospital') || [];
          const sp = document.getElementById('near-speciality');
          const hp = document.getElementById('near-hospital');
          specs.forEach(s => sp.insertAdjacentHTML('beforeend', `<option value="${s}">${s}</option>`));
          hospitals.forEach(h => hp.insertAdjacentHTML('beforeend', `<option value="${h}">${h}</option>`));
        } catch (e) {}
      }
      populateNearFilters();

      // Simple helper function called by existing logic when filters change
      (function wireFiltersForStatus() {
        ['program','quota','speciality','hospital'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.addEventListener('change', (e) => {
            setHelperStatus(`Filtered by ${e.target.id}: ${e.target.value || 'All'}`);
            // allow existing updateList() to run as it already does
          });
        });
      })();

      // Allow pressing Enter in the small PMDC input to copy to main search and navigate
      document.getElementById('pmdc-input-2').addEventListener('keydown', function (e) { if (e.key === 'Enter') { document.getElementById('pmdc-input').value = this.value; getCandidateMerit(); } });

      // show near merit placeholder (connects to your existing showNearMeritMatches)
      function showNearMeritMatches() {
        const m = document.getElementById('merit-input').value;
        if (!m) { document.getElementById('near-results').textContent = 'Enter your merit first.'; return; }
        document.getElementById('near-results').textContent = 'Searching...';
        // call existing function if available
        if (typeof showNearMeritMatches === 'function' && showNearMeritMatches !== arguments.callee) {
          return showNearMeritMatches();
        }
        // otherwise show placeholder
        setTimeout(()=> document.getElementById('near-results').textContent = 'No matches (placeholder).', 600);
      }
    </script>


 <script>
    const default_filter = {
      program: "FCPS",
      quota: "",
      speciality: "",
      hospital: "",
    };
    let meritData = {
      FCPS: fcpsMerit,
      MS: msMerit,
      MD: mdMerit,
    };
    const columnParams = ['pmdcNo', 'name', 'quotaName', 'specialityName', 'hospitalName']
    jQuery(document).ready(function () {
      $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
      $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    
      jQuery("#statTable").DataTable({
        order: [[5, 'desc']],
        paging: true,
        searching: true,
        ordering: true,
        lengthMenu: [10, 25, 50, { label: "All", value: -1 }],
        lengthChange: true,
        layout: {
          topStart: {
              buttons: [
                {
                    extend: 'pdfHtml5',
                    text: 'Download PDF',
                    title : 'estimatedMeritListJune2025 ',
               
                    title : 'estimatedMeritListJune2025 ',
               
                    customize: function (doc) {
                        
                        let table = doc.content[1].table.body;
                        console.log(table)
                        for (i = 1; i < table.length; i++) // skip table header row (i = 0)
                        {
                          let txt = table[i][6].text.replace('Check Joining', '')
                          table[i][6].text = txt; // couldn't be bothered clearing the Age column sample data above :)
                          
                        }
                        console.log(doc['header'])
                        var cols = [];
                        cols[0] = {text: 'List downloaded', alignment: 'left', margin:[20] };
                        cols[1] = {text: 'from PRP statistics', alignment: 'right', margin:[0,0,20] };
                        var objFooter = {};
                        objFooter['columns'] = cols;
                        doc['footer']=objFooter;

                        }
                        }
                        // Data URL generated by http://dataurl.net/#dataurlmaker
                    
                
            ]
          }
    },
    
        columns: [
          { width: "10%" },
          { width: "20%" },
          { width: "10%" },
          { width: "10%" },
          { width: "20%" },
          { width: "5%" },
          { width: "5%" },
          { width: "5%" },
        ],
      });
      changeMeritList();
    });
    
    async function changeMeritList() {
      const ele = document.getElementById('headline');
      ele.innerHTML = changeHeadline(default_filter);
      let merit = getMerit(
        meritData[default_filter.program],
        default_filter.quota,
        default_filter.speciality,
        default_filter.hospital
      );
      /*
      /*
      let seats = getSeatsOccupied(meritData[default_filter.program],default_filter.program,  default_filter.quota, default_filter.hospital, default_filter.speciality);
      for (k in seats) {        
        const ele = document.getElementById(k).innerHTML = seats[k]
      }*/
      }*/
      jQuery("#statTable").DataTable().clear().draw();
      for (cand in merit) {
        jQuery("#statTable")
          .DataTable()
          .row.add([
            merit[cand].pmdcNo,
            merit[cand].nameFull,
            merit[cand].quotaName,
            merit[cand].specialityName,
            merit[cand].hospitalName,
            merit[cand].marksTotal,
            "Pref No."+merit[cand].preferenceNo+"<br><span class='check-consent' onmousedown='checkConsent("+merit[cand].applicantId+")'>Check Consent</span><br><span class='consentstatusstyle' id='status-"+merit[cand].applicantId.toString()+"'></span>",
          ]);
            merit[cand].pmdcNo,
            merit[cand].nameFull,
            merit[cand].quotaName,
            merit[cand].specialityName,
            merit[cand].hospitalName,
            merit[cand].marksTotal,
            "Pref No."+merit[cand].preferenceNo+"<br><span class='check-consent' onmousedown='checkConsent("+merit[cand].applicantId+")'>Check Consent</span><br><span class='consentstatusstyle' id='status-"+merit[cand].applicantId.toString()+"'></span>",
          ]);
      }
      jQuery("#statTable").DataTable().draw();
    }
      
      $('#statTable').on('click', 'tbody td', function() {   
        let param =   columnParams[this._DT_CellIndex.column];
        let paths = {
          specialityName : 'speciality.html',
          hospitalName : 'hospital.html',
          pmdcNo : 'candidate.html'
        }
        const checkParams = ['hospitalName', 'pmdcNo', 'specialityName'];
        if (checkParams.includes(columnParams[this._DT_CellIndex.column]))
        {
        localStorage.setItem(columnParams[this._DT_CellIndex.column], this.textContent)
        window.location.href = paths[param]
        }
      }
  ) 
  ) 
    function getCandidateMerit() {
      let pmdcNoValue = document.getElementById('pmdc-input');
      localStorage.setItem('pmdcNo', pmdcNoValue.value);
      window.location.href = 'candidate.html'
      
    }


    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    const filters = document.getElementsByTagName("select");
    console.log(filters);
    for (filter in filters) {
      let options = getOptions(filters[filter].id);
      let options = getOptions(filters[filter].id);
      for (opt in options) {
        filters[filter].innerHTML +=
          "<option value='" + options[opt] + "'>" + options[opt] + "</option>";
      }
    }
    for (key in default_filter) {
      const ele = document.getElementById(key);
      ele.value = default_filter[key];
    }
    function updateList(e) {
      default_filter[e.target.id] = e.target.value;
      console.log(default_filter);
      changeMeritList();
    }
    for (program in accuracyMerit) {
  const ele = document.getElementById(program);
  ele.innerHTML = accuracyMerit[program].accuracy; // Show total candidates
  ele.innerHTML = accuracyMerit[program].accuracy; // Show total candidates

  // Calculate and show correctly placed candidates
  const correct = accuracyMerit[program].correctCandidates;
  const correctEle = document.getElementById(program + '-correct');
  if (correctEle) {
    correctEle.innerHTML = `<span style="color:#5cdb71;font-weight:600;">Correctly placed Candidates: ${correct}</span>`;
  }
}
    
    
    async function checkConsent(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getConsent(applicantId);

    }
    async function checkJoining(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getJoining(applicantId);

    }
    window.addEventListener('load', function() {
  setTimeout(function() {
    document.getElementById('loading-overlay').style.opacity = 0;
    setTimeout(function() {
      document.getElementById('loading-overlay').style.display = 'none';
    }, 400);
  }, 300); // Optional: keep spinner for at least 300ms for smoothness
});
    /*
    function changeMeritYear(e) {
      
  if (e.checked) {
    localStorage.setItem('viewUnofficial', 'true');
    meritData.FCPS = fcpsMeritUnOfficial;
    meritData.MS = msMeritUnOfficial;
    meritData.MD = mdMeritUnOfficial;
    candData = candDataUnOfficial;
    changeMeritList()
    $('.slidertext').css({'color': 'white', 'font-weight': 'bold', 'filter': 'drop-shadow(0px 0px 7px #107e47)', 'transition-duration': '1s'})
    changeNotification("This is a unofficial Merit list based on unofficial<span class='important'> 2025 Jan</span> Gazette<br>To compare ur merit, see unofficial gazette and click on applicant ID <br><span class='important'>Click on speciality or hospital to see individual merits</span><br>Merit list is updated according to current policy, without program marks.<br><span class='important'>Now you can see how many seats are occupied for  specific speciality and hospital</span>")
    
  }else {
    localStorage.setItem('viewUnofficial', 'false');
    meritData.FCPS = prevfcpsMeritList;
    meritData.MS = prevMsMeritList;
    meritData.MD = prevMdMeritList;
    candData = prevcandList;
    changeMeritList()
    changeNotification(" This is the Estimated Merit List of <span class='important'>2025 Jan</span> Induction<br>Accuracy of unofficial merit list has been displayed below<span class='important'>  </div>")
    $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    

  }
}*/
function gotoComment(){
  const ele = document.getElementById('HCB_comment_box');
  ele.scrollIntoView();
}
  </script>
  

<script>
const PAGE_NOTICES = [
  {
    badge: 'WIP',
    title: 'Site Redesign in Progress',
    subtitle: 'Note some things might not work or throw error, might still be in old design.',
    extra: '...Stay tuned for the new look!',
    ctaText: 'Home',
    ctaHref: 'index.html',
    tone: 'info' // 'info'|'warn'|'success'
  },
  {
    badge: 'Unofficial',
    title: 'Unofficial lists have been published',
    subtitle: 'Unofficial gazette for Jan 2026 induction is now available. Merit list according to unofficial gazette is also live.',
    extra: '',
    ctaText: 'WIP',
    ctaHref: '/prp-site/2025/index.html',
    tone: 'warn'
  }
];

const NOTICE_INTERVAL = 8000; // ms, change if you want faster/slower rotation

const NoticeSlideshow = (function () {
  let notices = [];
  let idx = 0;
  let timer = null;
  let interval = NOTICE_INTERVAL;
  const carousel = document.getElementById('notice-carousel');
  const dotsEl = document.getElementById('notice-dots');
  const prevBtn = document.getElementById('notice-prev');
  const nextBtn = document.getElementById('notice-next');
  const controls = document.getElementById('notice-controls');
  const progressBar = document.getElementById('notice-progress-bar');

  function buildSlides(arr) {
    notices = Array.isArray(arr) ? arr.slice() : [];
    carousel.innerHTML = '';
    dotsEl.innerHTML = '';

    if (!notices.length) { carousel.innerHTML = '<div class="notice-slide active"><div class="notice-content"><div class="notice-left"><div class="notice-badge">Info</div></div><div class="notice-body"><div class="notice-title">No notices</div><div class="notice-sub">There are no page notices at the moment.</div></div></div></div>'; controls.classList.add('hidden'); dotsEl.classList.add('hidden'); return; }

    notices.forEach((n, i) => {
      const slide = document.createElement('div');
      slide.className = 'notice-slide';
      slide.dataset.index = i;
      slide.setAttribute('role', 'group');
      slide.setAttribute('aria-roledescription', 'slide');

      // Build slide DOM (avoid template literal innerHTML to prevent backtick/escape issues)
      const content = document.createElement('div');
      content.className = 'notice-content';

      const left = document.createElement('div');
      left.className = 'notice-left';
      const badge = document.createElement('div');
      badge.className = 'notice-badge';
      badge.style.borderLeft = '0';
      badge.style.padding = '8px 10px';
      badge.style.fontWeight = '800';
      badge.style.color = (n.tone === 'warn') ? 'var(--accent-2)' : 'var(--accent)';
      badge.textContent = n.badge || '';
      left.appendChild(badge);

      const body = document.createElement('div');
      body.className = 'notice-body';
      const title = document.createElement('div');
      title.className = 'notice-title';
      title.textContent = n.title || '';
      const sub = document.createElement('div');
      sub.className = 'notice-sub';
      sub.style.marginTop = '6px';
      // allow light HTML in subtitle/extra if present
      sub.innerHTML = n.subtitle || '';
      body.appendChild(title);
      body.appendChild(sub);
      if (n.extra) {
        const extra = document.createElement('div');
        extra.className = 'notice-extra';
        extra.textContent = n.extra;
        body.appendChild(extra);
      }
      if (n.ctaText) {
        const cwrap = document.createElement('div');
        cwrap.style.marginTop = '10px';
        const btn = document.createElement('button');
        btn.className = 'notice-btn small';
        btn.dataset.href = n.ctaHref || '';
        btn.dataset.index = i;
        btn.setAttribute('aria-label', 'Open notice link');
        btn.style.cssText = 'background:linear-gradient(90deg,var(--accent),#2fc7b8); color:#071017; padding:6px 10px; border-radius:8px; font-weight:800; border:none; cursor:pointer';
        btn.textContent = n.ctaText;
        btn.addEventListener('click', () => { if (btn.dataset.href) window.location.href = btn.dataset.href; });
        cwrap.appendChild(btn);
        body.appendChild(cwrap);
      }

      content.appendChild(left);
      content.appendChild(body);
      slide.appendChild(content);
       carousel.appendChild(slide);

      // dot (kept same)
      const dot = document.createElement('button');
      dot.className = 'notice-dot';
      dot.setAttribute('aria-label', `Show notice ${i + 1}`);
      dot.dataset.index = i;
      dot.addEventListener('click', () => showNotice(i, true));
      dotsEl.appendChild(dot);
    });

    // show first slide
    idx = 0;
    showNotice(0);
    attachCTAs();
    controls.classList.toggle('hidden', notices.length <= 1);
    dotsEl.classList.toggle('hidden', notices.length <= 1);
  }

  function attachCTAs() {
    carousel.querySelectorAll('.notice-btn').forEach(b => {
      b.addEventListener('click', (e) => {
        const href = b.dataset.href;
        if (href) window.location.href = href;
      });
    });
  }

  function showNotice(i, userTriggered = false) {
    const slides = carousel.querySelectorAll('.notice-slide');
    slides.forEach(s => s.classList.remove('active'));
    const dots = dotsEl.querySelectorAll('.notice-dot');
    dots.forEach(d => d.classList.remove('active'));
    const slide = slides[i];
    if (slide) slide.classList.add('active');
    if (dots[i]) dots[i].classList.add('active');
    idx = i;
    resetProgress();
    if (userTriggered) { restartAutoplay(); }
    // set tone class on outer container
    const tone = (notices[i] && notices[i].tone) || 'info';
    const wrap = document.getElementById('notif');
    wrap.classList.remove('notice-info', 'notice-warn', 'notice-success');
    wrap.classList.add('notice-' + (tone || 'info'));
  }

  function next() { showNotice((idx + 1) % notices.length, false); }
  function prev() { showNotice((idx - 1 + notices.length) % notices.length, false); }

  function startAutoplay() {
    clearTimer();
    if (notices.length <= 1) return;
    progressBar.style.transition = `none`;
    progressBar.style.width = '0%';
    // allow CSS reflow before animation
    requestAnimationFrame(() => {
      progressBar.style.transition = `width ${interval}ms linear`;
      progressBar.style.width = '100%';
    });
    timer = setTimeout(() => {
      next();
      startAutoplay();
    }, interval);
  }

  function resetProgress() {
    progressBar.style.transition = 'none';
    progressBar.style.width = '0%';
    // restart progress
    requestAnimationFrame(() => {
      progressBar.style.transition = `width ${interval}ms linear`;
      progressBar.style.width = '100%';
    });
  }

  function pause() { clearTimer(); progressBar.style.transition = 'none'; }
  function resume() { startAutoplay(); }

  function clearTimer() { if (timer) { clearTimeout(timer); timer = null; } }

  function restartAutoplay() { clearTimer(); startAutoplay(); }

  function wireUI() {
    nextBtn.addEventListener('click', () => { next(); restartAutoplay(); });
    prevBtn.addEventListener('click', () => { prev(); restartAutoplay(); });

    // pause on hover/focus for accessibility
    const wrap = document.getElementById('notif');
    ['mouseenter','focusin'].forEach(ev => wrap.addEventListener(ev, pause));
    ['mouseleave','focusout'].forEach(ev => wrap.addEventListener(ev, resume));

    // keyboard navigation: left/right arrows
    wrap.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') { next(); restartAutoplay(); }
      if (e.key === 'ArrowLeft') { prev(); restartAutoplay(); }
    });
  }

  function setNotices(arr, opts = {}) {
    if (!Array.isArray(arr)) arr = [arr];
    notices = arr.slice();
    interval = opts.interval || NOTICE_INTERVAL;
    buildSlides(notices);
    startAutoplay();
  }

  // public API
  return {
    init: function (arr, opts = {}) { setNotices(arr || [], opts); wireUI(); },
    set: setNotices,
    next, prev, pause, resume, getCurrent: () => idx
  };
})();

// Init slideshow on DOM ready using PAGE_NOTICES; keeps backward-compatible single PAGE_NOTICE too
document.addEventListener('DOMContentLoaded', () => {
  NoticeSlideshow.init(PAGE_NOTICES);
});

// Backwards-compatible helper to set a single page notice
function setPageNotice(newCfg) {
  // accept either single object or array
  if (Array.isArray(newCfg)) NoticeSlideshow.set(newCfg);
  else NoticeSlideshow.set([newCfg]);
}

// convenience: programmatic update of the notices array
function setPageNotices(noticesArray, opts = {}) {
  NoticeSlideshow.set(noticesArray, opts);
}
</script>
<script>
(function(){
  // Lightweight helpers moved from modified-index.html
  function wait(ms){ return new Promise(r=>setTimeout(r,ms)); }
  const joiningCache = {};
  async function getJoiningSafe(applicantId, retries = 3){
    if(joiningCache[applicantId]) return joiningCache[applicantId];
    for(let i=0;i<retries;i++){
      try{
        const res = await $.ajax({url: `https://prp-api.vercel.app/joining/${applicantId}/`, method: 'GET'});
        joiningCache[applicantId] = res;
        return res;
      }catch(err){
        if(i < retries - 1) await wait(200);
        else { console.warn(`‚ùå API failed for ${applicantId} after ${retries} tries`); return undefined; }
      }
    }
  }

  async function nonJoinersNotice(){
    const table = $('#statTable').DataTable();
    const pageRows = table.rows({ page: 'current' }).nodes();
    const container = document.getElementById('nonJoinNotif');
    container.innerHTML = '';

    let nonJoinerCount = 0;
    const itemWrapper = document.createElement('div');
    itemWrapper.style.display = 'flex';
    itemWrapper.style.flexWrap = 'wrap';
    itemWrapper.style.gap = '0.6em';

    const tasks = [];
    for (let i = 0; i < pageRows.length; i++) {
      const $row = $(pageRows[i]);
      tasks.push((async function(i, $row){
        await wait(i * 100);
        const statusCell = $row.find('.consentstatusstyle');
        const idAttr = statusCell.attr('id');
        if (!idAttr) return;
        const applicantId = idAttr.split('-')[1];
        const joiningStatus = await getJoiningSafe(applicantId);
        const div = document.createElement('div'); div.innerHTML = joiningStatus || '';
        const plainStatus = (div.textContent || div.innerText || '').trim().toLowerCase();
        if (plainStatus !== 'joined') {
          nonJoinerCount++;
          const applicantName = $row.find('td:nth-child(2)').text().trim();
          const quota = $row.find('td:nth-child(3)').text().trim();
          const speciality = $row.find('td:nth-child(4)').text().trim();
          const hospital = $row.find('td:nth-child(5)').text().trim();
          const block = document.createElement('span');
          block.className = 'nonjoin-item';
          block.setAttribute('data-tippy-content', `üö´ Seat wasted at:<br><b>${speciality}</b>, <b>${hospital}</b><br>Quota: ${quota}<br><i>${applicantName}</i>`);
          block.innerHTML = `<b>‚ùå ${applicantId}</b>`;
          itemWrapper.appendChild(block);
        }
      })(i, $row));
    }

    await Promise.all(tasks);

    if (nonJoinerCount > 0) {
      const heading = document.createElement('div');
      heading.innerHTML = `‚ö†Ô∏è <b>${nonJoinerCount}</b> seat${nonJoinerCount > 1 ? 's' : ''} wasted on this page`;
      heading.style.marginBottom = '0.5em';
      heading.style.color = '#ffadad';
      heading.style.fontWeight = 'bold';
      heading.style.fontSize = '1em';
      container.appendChild(heading);
      container.appendChild(itemWrapper);
      container.style.display = 'block';
    } else {
      container.style.display = 'none';
    }

    // initialize tooltips
    if (typeof tippy === 'function') {
      tippy('[data-tippy-content]', { allowHTML: true, placement: 'top', theme: 'light-border', animation: 'scale-subtle', delay: [100, 0] });
    }
  }

  // Wire to table draws
  $('#statTable').on('draw.dt', function () { nonJoinersNotice(); });

  async function showNextCandidate(elem){
    const table = $('#statTable').DataTable();
    const row = $(elem).closest('tr');
    const rowIndex = table.row(row).index();
    const rowData = table.row(rowIndex).data();

    const selectedCandidate = { nameFull: rowData[1], marksTotal: parseFloat(rowData[5]) };
    const program = default_filter.program;
    const quota = rowData[2];
    const speciality = rowData[3];
    const hospital = rowData[4];

    const next = await nextCandidateInLine(selectedCandidate, program, quota, speciality, hospital);
    if (!next) { alert("No next candidate found."); return; }

    const count = (parseInt($(elem).data('count')) || 0) + 1;
    const updatedRow = [
      next.pmdcNo,
      next.nameFull,
      next.quotaName,
      next.specialityName,
      next.hospitalName,
      next.marksTotal,
      `Pref No.${next.preferenceNo}<br><span class='check-consent' onmousedown='checkConsent(${next.applicantId})'>Check Consent</span><br><span class='consentstatusstyle' id='status-${next.applicantId}'></span>`,
      `<span data-count='${count}' class='next-candidate' onclick='showNextCandidate(this)'>Show Next Candidate</span>`
    ];

    table.row(rowIndex).data(updatedRow).draw(false);
    $(row).addClass('row-highlight');
  }

  function loadComments(){
    const btn = document.getElementById('showCommentsBtn'); if (btn) btn.style.display='none';
    var wrapper = document.getElementById('HCB_wrapper'); if(wrapper){ wrapper.style.display = 'block'; wrapper.classList.add('neon-comments'); }
    var s=document.createElement('script'), l=''+window.location, h='https://www.htmlcommentbox.com';
    s.setAttribute('type','text/javascript');
    s.setAttribute('src', h+'/jread?page='+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24mzyYuuZBe1GhURDyiqYE4%2F"+"&opts=16798&num=10&ts="+Date.now());
    document.getElementsByTagName('head')[0].appendChild(s);
  }

  // Nav toggle handled by site-theme.js (shared)

  // expose useful functions for debugging
  window.getJoiningSafe = getJoiningSafe;
  window.nonJoinersNotice = nonJoinersNotice;
  window.showNextCandidate = showNextCandidate;
  window.loadComments = loadComments;

})();
</script>
<script src="site-theme.js"></script>
</body>
</html>
