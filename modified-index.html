<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PRP Statistics</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sync-fetch"></script>
    <script id='data' src="data.js"></script>
    <script src="schedule.js"></script>
   <script src="nil.js"></script>
   <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link
    href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.8/r-3.0.2/sl-2.0.3/datatables.min.css"
    rel="stylesheet"
  />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/v/dt/dt-2.0.8/b-3.0.2/b-html5-3.0.2/datatables.min.js"></script>
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="site-theme.css" />
    <link rel="stylesheet" href="site-theme.css" />
    <link rel="stylesheet" href="index.compact.css" />
    <link rel="stylesheet" href="github-theme.css" />
  </head>
  <body class="site-root github-dark">
      <div class="nav-content">
        <div class="logo-container">
          <img class="logo" onclick="gotoUrl()" src="logo.png" />
        </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <!--<li><a href="hospital.html">Hospitals</a></li>-->
          <!--<li><a href="speciality.html">Specialities</a></li>-->
          <li><a href="wasted.html">Wasted Seats</a></li>
          <li><a href="review.html">Training Reviews</a></li>
          <li><a href="cutoff.html">Cutoff Merits</a></li>
          <li><a href="schedule.html">Schedule</a></li>
          <li><a href="/prp-site/2025/index.html">Gazette</a></li>
          <li><a href="prev.html">Previous Merit Lists</a></li>
        </ul>
      </div>
    </nav>

    <!-- Notification slideshow (JSON-driven) -->
    <div id="notifCarousel" class="container mt-4">
      <div class="relative">
        <div id="notifSlides" class="space-y-3"></div>
        <div id="notifControls" class="flex items-center justify-center gap-2 mt-3"></div>
        <div class="absolute right-3 top-2 flex gap-2">
          <button id="notifPrev" class="btn-icon">‚óÄ</button>
          <button id="notifNext" class="btn-icon">‚ñ∂</button>
        </div>
      </div>
    </div>

  <!---
<div class="navbar notif" id="notif">

  <div style="margin-bottom: 1em; background: #1e1f22; border-left: 4px solid #5cdb71; padding: 0.6em 1em; border-radius: 6px;">
    <strong style="color:#5cdb71;">üìä New:</strong> Explore <b>Cutoff Merits</b> for each specialty in the <b>Cutoff Dashboard</b> below.
  </div>

  <strong style="color:#5cdb71;">‚úÖ Round 6 Merit List Published!</strong><br>
  Released by the <span style="color:#ffe066; font-weight:600;">official authority</span>. Use <b>"Check Consent"</b> to verify applicant status.<br>
  <span style="color:#7fffa7;">‚ú® <b>Show Next Candidate:</b></span> Preview who‚Äôs next if consent is not given.

  <br><br>

  <span style="color:#ffd43b; font-weight:600;">üìâ New Feature: Wasted Seat Tracker</span><br>
  <span style="color:#aaa;">See hospitals/specialties where seats were left vacant due to candidates not joining.</span>

  <hr style="border-color: rgba(255,255,255,0.1); margin: 1em 0;">

  <div style="
    padding: 0.7em 1em;
    background: #1e1f22;
    border-left: 4px solid #00ffaa;
    border-radius: 6px;
    box-shadow: 0 0 15px rgba(0, 255, 170, 0.25);
    animation: glowPulse 2s infinite;
  ">
    <strong style="color:#00ffaa;">üìÅ July 2025 Lists Added to Archive</strong><br>
    <a href="https://prpdatastat.github.io/prp-site/prev.html" target="_blank" style="color:#ffe066; font-weight:bold; text-decoration:underline;">
      üîó prpdatastat.github.io/prp-site/prev.html
    </a>
  </div>
</div>
--->





    <div class="main_container">
      



      <aside class="tool-sidebar">
        <div class="tools-tabs">
          <div class="tab-list" role="tablist">
            <button class="tab-button active" data-tab="tab-search" role="tab" aria-selected="true" aria-controls="tab-search">Search</button>
            <button class="tab-button" data-tab="tab-near" role="tab" aria-selected="false" aria-controls="tab-near">Near-merit</button>
            <button class="tab-button" data-tab="tab-tools" role="tab" aria-selected="false" aria-controls="tab-tools">Links</button>
          </div>
          <div id="tab-search" class="tab-panel active" role="tabpanel" aria-hidden="false">
            <div class="tool-panel">
              <div class="tool-body">
                <div class="compact-row mb-2">
                  <input id="pmdc-input" type="text" placeholder="üîé Enter PMDC Number" class="pmdc-input" onkeydown="if(event.key==='Enter'){getCandidateMerit();}" autocomplete="off" />
                  <button onclick="getCandidateMerit()" class="compact-btn">Search</button>
                </div>
              </div>
            </div>
          </div>
          <div id="tab-near" class="tab-panel" role="tabpanel" aria-hidden="true">
            <div class="tool-panel">
              <div class="tool-body">
                <h3 style="margin-top:0; margin-bottom:6px; color:var(--text-main)">üéØ Check near-merit Matches</h3>
                <div class="compact-row compact-wrap mb-1">
                  <input id="merit-input" type="number" placeholder="Your merit (e.g. 31.2)" class="compact-input" />
                  <select id="merit-program" class="compact-input filter-item"><option value="MS">MS</option><option value="MD">MD</option><option value="FCPS">FCPS</option></select>
                  <input id="merit-threshold" type="number" min="0.5" max="10" step="0.1" value="3" placeholder="¬± Marks" class="compact-input" />
                </div>
                <div class="compact-row small-gap mb-1">
                  <select id="filter-speciality" class="compact-input filter-item"></select>
                  <select id="filter-hospital" class="compact-input filter-item"></select>
                  <button onclick="showNearMeritMatches()" class="compact-btn">Show Matches</button>
                </div>
              </div>
            </div>
          </div>
          <div id="tab-tools" class="tab-panel">
            <div class="tool-panel">
              <div class="tool-body">
                <p class="text-muted">Quick links</p>
                <div style="display:flex; gap:0.4em; flex-wrap:wrap;">
                  <button class="compact-btn" onclick="gotoUrl('schedule.html')">Schedule</button>
                  <button class="compact-btn" onclick="gotoUrl('cutoff.html')">Cutoff</button>
                  <button class="compact-btn" onclick="gotoUrl('review.html')">Reviews</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div class="flex stat-container">
        <div class="stat-card compact">
  <div id="FCPS" class="stat-number">1,234</div>
  <div class="stat-desc">FCPS</div>
  <div class="stat-label">Similar to estimated merit list</div>
  <div style='display:none;' class="stat-correct" id="FCPS-correct"></div>
</div>
<div class="stat-card compact">
  <div id="MS" class="stat-number">1,234</div>
  <div class="stat-desc">MS</div>
  <div class="stat-label">Similar to estimated merit list</div>
  <div style='display:none;' class="stat-correct" id="MS-correct"></div>
</div>
<div class="stat-card compact">
  <div id="MD" class="stat-number">1,234</div>
  <div class="stat-desc">MD</div>
  <div class="stat-label">Similar to estimated merit list</div>
  <div style='display:none;' class="stat-correct" id="MD-correct"></div>
</div>
    
      
      
      </div>
      <div>
        <!--<button class="schd-button lrgbtn" onmousedown="gotoUrl('schedule.html')"> View PRP Schedule </button>-->
       <!-- <button class="schd-button lrgbtn" onmousedown="gotoUrl('scrutiny.html')"> View 2025 Grievance List </button> -->
        

        <!--<h3 class="simple-text">Unofficial <small class='important'> click on buttons below</small></h3>        
        <br>
        <button class="schd-button lrgbtn" onmousedown="gotoUrl('/prp-site/2025/index.html')">June Unofficial 2025 Gazette </button>
        <button class="schd-button lrgbtn" onmousedown="gotoUrl('/prp-site/scrutiny.html')"> View June Rejected List </button>
        <br>-->
        <!--
        <button class="schd-button lrgbtn unofficial" onmousedown="gotoUrl('/prp-site/2025/merit.html')">Feb 2025 Merit </button>
        <button class="schd-button lrgbtn unofficial" onmousedown="gotoUrl('/prp-site/2025/rejection.html')">Feb 2025 Scrutiny</button>
         -->
      </div>    
      <h3 class="linkableunderline" onclick="gotoComment()"> Wanna Leave a comment for developer? Click here!</h3>
      <!--
      <div class="consent-pref-switch">
        <label class="switch">
          <input id="checkbox2025" onchange="changeMeritYear(this)" type="checkbox">
          <span class="slider"></span>
        </label><span class="slidertext"> 2025 Unofficial Merit List</span> 
      </div>  
       -->
      
  <div id="hopeBoxContainer" class="hope-highlight"></div>
  
       <div class="alert merit-desc compact-alert">
  <!--<strong>About this Merit List</strong><br>
  This merit list is compiled from the <span style="color:var(--accent);font-weight:600;">official gazette</span>. The statistics above show how closely the estimated merit list based on official gazette matches the previously published unofficial merit, including the number of candidates <span style="color:var(--accent);font-weight:600;">correctly placed</span> in both lists.<br>
  <span style="color:#b5ffcb;">This provides transparency and helps you assess the accuracy of the unofficial data.</span>
  <br><br>
  <span style="color:#aaa;">You can now click on hospital and speciality name to check individual merit lists.</span>-->
</div>


  <!-- PMDC Search -->
  <div class="compact-row mb-2">
    <input
      id="pmdc-input"
      type="text"
      placeholder="üîé Enter PMDC Number"
      class="pmdc-input"
      onkeydown="if(event.key==='Enter'){getCandidateMerit();}"
      autocomplete="off"
    />
    <button
      onclick="getCandidateMerit()"
      class="compact-btn"
    >Search</button>
  </div>
  <h2 style="margin-top: 8px;">
    üéì Check near-merit Matches
  </h2>
  <p style="margin-bottom: 0.8em;">
   Explore how close your merit was to selection.<br>
Enter your merit and optionally filter by specialty or hospital.<br>
At least a threshold or one filter is required.<br>
You must provide either a threshold or a filter to generate meaningful results.  </p>
  <!-- Merit Input -->
  <div class="compact-row compact-wrap mb-1">
    <input
      id="merit-input"
      type="number"
      placeholder="üéØ Your merit (e.g. 31.2)"
      class="compact-input"
    />
    <select
      id="merit-program"
      class="compact-input"
    >
      <option value="MS">MS</option>
      <option value="MD">MD</option>
      <option value="FCPS">FCPS</option>
    </select>
    <input
      id="merit-threshold"
      type="number"
      min="0.5"
      max="10"
      step="0.1"
      value="3"
      placeholder="¬± Marks"
      class="compact-input"
    />
    <div class="compact-row small-gap mb-1">
    <select id="filter-speciality" type="text" placeholder="Filter by speciality" class="compact-input filter-item"></select>
    <select id="filter-hospital" type="text" placeholder="Filter by hospital" class="compact-input filter-item"></select>
    <button onclick="showNearMeritMatches()" class="compact-btn">Show Matches</button>
  </div>
  </div>
  
</div>

</div>


      <h4 class="seats"> Seats Occupied: <span class="important" id="occupied">1</span> / <strong id="total"> 2 </strong></h4>
      <div id="nonJoinNotif" class="compact-nonjoin" aria-live="polite"></div>
      <div class="filters">
        <select
          onchange="updateList(event);"
          class="filter-item compact-input"
          name="quota"
          id="program"
        >
          <option value="" disabled selected>Program</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item compact-input"
          name="speciality"
          id="quota"
        >
          <option value="" selected>Quota</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item compact-input"
          name="quota"
          id="speciality"
        >
          <option value="" selected>Speciality</option>
        </select>
        <select
          onchange="updateList(event);"
          class="filter-item compact-input"
          name="quota"
          id="hospital"
        >
          <option value="" elected>Hospital</option>
        </select>
      </div>
      <p id="headline"> No Filter selected.</p>
      <table class="stat-table" style="width: 100%" id="statTable">
        <thead>
          <tr>
            <th class="linkable">PMDC Number</th>
            <th >Name</th>
            <th>Quota</th>
            <th class="linkable">Speciality</th>
            <th class="linkable">Hospital</th>
            <th>Aggregate</th>
            <th>Preference No.</th>
            <!--<th>Next Candidate in Line</th>--->
          </tr>
        </thead>
        <tbody id="dataRows"></tbody>
      </table>
      <br>
     
<br>
<button id="showCommentsBtn" class="compact-btn" onclick="loadComments()">Show comments</button>
<div id="HCB_wrapper"><div id="HCB_comment_box"></div></div>
<script>
function loadComments(){
  document.getElementById('showCommentsBtn').style.display='none';
  // show and style our comments container so third-party box renders into themed area
  var wrapper = document.getElementById('HCB_wrapper');
  if(wrapper){ wrapper.style.display = 'block'; wrapper.classList.add('neon-comments'); }
  var s=document.createElement('script'), l=''+window.location, h='https://www.htmlcommentbox.com';
  s.setAttribute('type','text/javascript');
  s.setAttribute('src', h+'/jread?page='+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24mzyYuuZBe1GhURDyiqYE4%2F"+"&opts=16798&num=10&ts="+Date.now());
  document.getElementsByTagName('head')[0].appendChild(s);
}
</script>

      <div class="footer">
        <span>Made with üíì in <strong>HTML</strong>  &  <strong>JS</strong> by <img src="github.png">reko-beep</span>
      </div>
    </div>
  </body>
  
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.tab-button').forEach(btn=>{
      btn.addEventListener('click', function(){
        document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        const tab = this.dataset.tab;
        document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
        const panel = document.getElementById(tab);
        if(panel) panel.classList.add('active');
      });
    });
    // ensure that tabs show correct panel even if created dynamically
    const activeBtn = document.querySelector('.tab-button.active');
    if(activeBtn){ activeBtn.click(); }
  });
  </script>
  <script src="notifications.js"></script>

  <script>
    const default_filter = {
      program: "FCPS",
      quota: "",
      speciality: "",
      hospital: "",
    };
    let meritData = {
      FCPS: fcpsMerit,
      MS: msMerit,
      MD: mdMerit,
    };
    const columnParams = ['pmdcNo', 'name', 'quotaName', 'specialityName', 'hospitalName']
    const joiningCache = {}; // Cache joining statuses

function wait(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function getJoiningSafe(applicantId, retries = 3) {
  if (joiningCache[applicantId]) return joiningCache[applicantId];

  for (let i = 0; i < retries; i++) {
    try {
      const res = await $.ajax({
        url: `https://prp-api.vercel.app/joining/${applicantId}/`,
        method: 'GET',
      });
      joiningCache[applicantId] = res;
      return res;
    } catch (err) {
      if (i < retries - 1) {
        await wait(200); // retry delay
      } else {
        console.warn(`‚ùå API failed for ${applicantId} after ${retries} tries`);
        return undefined; // treat as not joined
      }
    }
  }
}

async function nonJoinersNotice() {
  const table = $('#statTable').DataTable();
  const pageRows = table.rows({ page: 'current' }).nodes();
  const container = document.getElementById('nonJoinNotif');
  container.innerHTML = '';

  let nonJoinerCount = 0;
  const itemWrapper = document.createElement('div');
  itemWrapper.style.display = 'flex';
  itemWrapper.style.flexWrap = 'wrap';
  itemWrapper.style.gap = '0.6em';
  itemWrapper.style.alignItems = 'center';

  const tasks = [];

  for (let i = 0; i < pageRows.length; i++) {
    const $row = $(pageRows[i]);

    const task = async () => {
      await wait(i * 100); // Stagger requests

      const statusCell = $row.find('.consentstatusstyle');
      const idAttr = statusCell.attr('id');
      if (!idAttr) return;

      const applicantId = idAttr.split('-')[1];

      const joiningStatus = await getJoiningSafe(applicantId);

      const div = document.createElement('div');
      div.innerHTML = joiningStatus || '';
      const plainStatus = (div.textContent || div.innerText || '').trim().toLowerCase();

      console.log(`Applicant ${applicantId}: "${plainStatus}"`);

      if (plainStatus !== 'joined') {
        nonJoinerCount++;

        const applicantName = $row.find('td:nth-child(2)').text().trim();
        const quota = $row.find('td:nth-child(3)').text().trim();
        const speciality = $row.find('td:nth-child(4)').text().trim();
        const hospital = $row.find('td:nth-child(5)').text().trim();

        const block = document.createElement('span');
        block.className = 'nonjoin-item';
        block.setAttribute('data-tippy-content',
          `üö´ Seat wasted at:<br><b>${speciality}</b>, <b>${hospital}</b><br>Quota: ${quota}<br><i>${applicantName}</i>`
        );
        block.innerHTML = `<b>‚ùå ${applicantId}</b>`;
        itemWrapper.appendChild(block);
      }
    };

    tasks.push(task());
  }

  await Promise.all(tasks);

  if (nonJoinerCount > 0) {
    const heading = document.createElement('div');
    heading.innerHTML = `‚ö†Ô∏è <b>${nonJoinerCount}</b> seat${nonJoinerCount > 1 ? 's' : ''} wasted on this page`;
    heading.style.marginBottom = '0.5em';
    heading.style.color = '#ffadad';
    heading.style.fontWeight = 'bold';
    heading.style.fontSize = '1em';
    container.appendChild(heading);
    container.appendChild(itemWrapper);
    container.style.display = 'block';
  } else {
    container.style.display = 'none';
  }

  tippy('[data-tippy-content]', {
    allowHTML: true,
    placement: 'top',
    theme: 'light-border',
    interactive: false,
    animation: 'scale-subtle',
    delay: [100, 0],
  });
}



    jQuery(document).ready(function () {
       // Prevent duplicate box rendering
  if ($("#hopeBoxContainer .hope-box").length > 0) return;

  $.getJSON("hope-messages.json", function (data) {
    const messages = data.messages || [];
    const titles = data.titles || ["You're Not Alone"];

    if (messages.length === 0) return;

    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
    const randomTitle = titles[Math.floor(Math.random() * titles.length)];
    console.log(randomMessage, randomTitle);
    const boxHtml = `
    <div class="hope-title neon-title font-bold mb-3 flex items-center gap-2 text-yellow-900 text-xl tracking-wide">üåü ${randomTitle}</div>
    <div class="hope-box neon-box text-sm">
      ${randomMessage}
    </div>
  
`;


    // ‚úÖ CORRECT: appending as HTML
    $("#hopeBoxContainer").append(boxHtml);
  });
  
  
  $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    
      jQuery("#statTable").DataTable({
        order: [[5, 'desc']],
        paging: true,
        searching: true,
        ordering: true,
        lengthMenu: [10, 25, 50, { label: "All", value: -1 }],
        lengthChange: true,
        layout: {
          topStart: {
              buttons: [
                {
                    extend: 'pdfHtml5',
                    text: 'Download PDF',
                    title : 'officialFirstRoundMeritList',
                    filename : function(){
                     default_filter.program + 'officialFirstRoundMeritList'
                    },

                    customize: function (doc) {
                        
                        let table = doc.content[1].table.body;
                        console.log(table)
                        for (i = 1; i < table.length; i++) // skip table header row (i = 0)
                        {
                          let txt = table[i][6].text.replace('Check Joining', '')
                          table[i][6].text = txt; // couldn't be bothered clearing the Age column sample data above :)
                          
                        }
                        console.log(doc['header'])
                        var cols = [];
                        cols[0] = {text: 'List downloaded', alignment: 'left', margin:[20] };
                        cols[1] = {text: 'from PRP statistics', alignment: 'right', margin:[0,0,20] };
                        var objFooter = {};
                        objFooter['columns'] = cols;
                        doc['footer']=objFooter;

                        }
                        }
                        // Data URL generated by http://dataurl.net/#dataurlmaker
                    
                
            ]
          }
    },
    
        columns: [
          { width: "10%" },
          { width: "20%" },
          { width: "10%" },
          { width: "10%" },
          { width: "20%" },
          { width: "5%" },
          { width: "5%" }
        ],
      });
      changeMeritList();
    });
    
    async function changeMeritList() {
      const ele = document.getElementById('headline');
      ele.innerHTML = changeHeadline(default_filter);
      let merit = getMerit(
        meritData[default_filter.program],
        default_filter.quota,
        default_filter.speciality,
        default_filter.hospital
      );
      let seats = getSeatsOccupied(meritData[default_filter.program],default_filter.program,  default_filter.quota, default_filter.hospital, default_filter.speciality);
      for (k in seats) {        
        const ele = document.getElementById(k).innerHTML = seats[k]
      }
      jQuery("#statTable").DataTable().clear().draw();
      for (cand in merit) {
        jQuery("#statTable")
          .DataTable()
          .row.add([
  merit[cand].pmdcNo,
  merit[cand].nameFull,
  merit[cand].quotaName,
  merit[cand].specialityName,
  merit[cand].hospitalName,
  merit[cand].marksTotal,
  "Pref No." + merit[cand].preferenceNo + "<br><span class='check-consent' onmousedown='checkJoining(" + merit[cand].applicantId + ")'>Check Joining</span><br><span class='consentstatusstyle' id='status-" + merit[cand].applicantId + "'></span>"
  //`<span data-count=0 class='next-candidate' onclick='showNextCandidate(this)'>Show Next Candidate</span>`

]);
      }
      jQuery("#statTable").DataTable().draw();
    }
    $('#statTable').on('draw.dt', function () {
  nonJoinersNotice();
});
      
      $('#statTable').on('click', 'tbody td', function() {   
        let param =   columnParams[this._DT_CellIndex.column];
        let paths = {
          specialityName : 'speciality.html',
          hospitalName : 'hospital.html',
          pmdcNo : 'candidate.html'
        }
        const checkParams = ['hospitalName', 'pmdcNo', 'specialityName'];
        if (checkParams.includes(columnParams[this._DT_CellIndex.column]))
        {
        localStorage.setItem(columnParams[this._DT_CellIndex.column], this.textContent)
        window.location.href = paths[param]
        }
      }
  );




    function getCandidateMerit() {
      let pmdcNoValue = document.getElementById('pmdc-input');
      localStorage.setItem('pmdcNo', pmdcNoValue.value);
      window.location.href = 'candidate.html'
      
    }


    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.innerHTML = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

    const filters = document.getElementsByTagName("select");
    console.log(filters);
    for (filter in filters) {
      let options = getOptions(String(filters[filter].id).replace('filter-', '') || filters[filter].id);
      for (opt in options) {
        filters[filter].innerHTML +=
          "<option value='" + options[opt] + "'>" + options[opt] + "</option>";
      }
    }
    for (key in default_filter) {
      const ele = document.getElementById(key);
      ele.value = default_filter[key];
    }
    function updateList(e) {
      default_filter[e.target.id] = e.target.value;
      console.log(default_filter);
      changeMeritList();
    }
    for (program in accuracyMerit) {
  const ele = document.getElementById(program);
  console.log(ele, program, accuracyMerit[program].accuracy);
  ele.innerHTML = String(accuracyMerit[program].accuracy) +"%"; // Show total candidates

  // Calculate and show correctly placed candidates
  const correct = accuracyMerit[program].correctCandidates;
  const correctEle = document.getElementById(program + '-correct');
  if (correctEle) {
    correctEle.innerHTML = `<span style="color:var(--accent);font-weight:600;">Correctly placed Candidates: ${correct}</span>`;
  }
}
    async function showNextCandidate(elem) {
    const $btn = $(this);
    let count = (parseInt($btn.data('count')) || 0) + 1;
    const table = $('#statTable').DataTable();
    const row = $(elem).closest('tr');
    const rowIndex = table.row(row).index(); // always correct
    const rowData = table.row(rowIndex).data(); // Current row

  // Reconstruct the selectedCandidate info
  const selectedCandidate = {
    nameFull: rowData[1], // name
    marksTotal: parseFloat(rowData[5]) // marks
  };

  const program = default_filter.program;
  const quota = rowData[2]; // quota
  const speciality = rowData[3];
  const hospital = rowData[4];
  console.log('Selected Candidate:', selectedCandidate, 'Program:', program, 'Quota:', quota, 'Speciality:', speciality, 'Hospital:', hospital);
  // Call your existing function to get next candidate
  console.log(selectedCandidate)
  
  const next = await nextCandidateInLine(selectedCandidate, program,  quota, speciality, hospital);

  if (!next) {
    alert("No next candidate found.");
    return;
  }
  console.log(next, 'next candidate');
  // Construct updated row data
  const updatedRow = [
    next.pmdcNo,
    next.nameFull,
    next.quotaName,
    next.specialityName,
    next.hospitalName,
    next.marksTotal,
    `Pref No.${next.preferenceNo}<br>
      <span class='check-consent' onmousedown='checkConsent(${next.applicantId})'>Check Consent</span><br>
      <span class='consentstatusstyle' id='status-${next.applicantId}'></span>`,
    `<span data-count='${count}' class='next-candidate' onclick='showNextCandidate(this)'>Show Next Candidate</span>`
  ];

  // Update the row
  table.row(rowIndex).data(updatedRow).draw(false);

  $(row).addClass('row-highlight');

 
}

    async function checkConsent(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getConsent(applicantId);

    }
    async function checkJoining(applicantId) {
      let ele = document.getElementById('status-'+applicantId.toString())
      console.log(ele, 'status-'+applicantId.toString())
      ele.innerHTML = '' + await getJoining(applicantId);

    }
    window.addEventListener('load', function() {
  setTimeout(function() {
    document.getElementById('loading-overlay').style.opacity = 0;
    setTimeout(function() {
      document.getElementById('loading-overlay').style.display = 'none';
    }, 400);
  }, 300); // Optional: keep spinner for at least 300ms for smoothness
});
    /*
    function changeMeritYear(e) {
      
  if (e.checked) {
    localStorage.setItem('viewUnofficial', 'true');
    meritData.FCPS = fcpsMeritUnOfficial;
    meritData.MS = msMeritUnOfficial;
    meritData.MD = mdMeritUnOfficial;
    candData = candDataUnOfficial;
    changeMeritList()
    $('.slidertext').css({'color': 'white', 'font-weight': 'bold', 'filter': 'drop-shadow(0px 0px 7px #107e47)', 'transition-duration': '1s'})
    changeNotification("This is a unofficial Merit list based on unofficial<span class='important'> 2025 Jan</span> Gazette<br>To compare ur merit, see unofficial gazette and click on applicant ID <br><span class='important'>Click on speciality or hospital to see individual merits</span><br>Merit list is updated according to current policy, without program marks.<br><span class='important'>Now you can see how many seats are occupied for  specific speciality and hospital</span>")
    
  }else {
    localStorage.setItem('viewUnofficial', 'false');
    meritData.FCPS = prevfcpsMeritList;
    meritData.MS = prevMsMeritList;
    meritData.MD = prevMdMeritList;
    candData = prevcandList;
    changeMeritList()
    changeNotification(" This is the Estimated Merit List of <span class='important'>2025 Jan</span> Induction<br>Accuracy of unofficial merit list has been displayed below<span class='important'>  </div>")
    $('.slidertext').css({'color': 'white','font-weight': 'light', 'filter': 'drop-shadow(0px 0px 0px #107e47)', 'transition-duration': '1s'})
    

  }
}*/
function gotoComment(){
  const ele = document.getElementById('HCB_comment_box');
  ele.scrollIntoView();
}
  </script>
<script src="site-theme.js"></script>
</html>
